<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Twitch Stream - Icha's Place</title>
  <!-- Using tuned system font stack from css/custom.css -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="css/custom.css" rel="stylesheet">
  <!-- Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="shortcut icon" href="images/favicon.ico">
  <meta name="theme-color" content="#ffffff">
  <!-- Page-specific styles centralized in css/custom.css -->
</head>
<body class="page-twitch use-internal-scroll">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
        <ul class="navbar-nav d-flex justify-content-center w-100">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="commodity-table.html">Multi Contract Cargo Tracker</a></li>
          <li class="nav-item"><a class="nav-link active" href="twitch.html">Twitch</a></li>
          <li class="nav-item"><a class="nav-link" href="https://github.com/icha-senpai/" target="_blank">GitHub</a></li>
          <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="main-viewport">
    <div class="container">
  <h2 class="text-center mb-4">Live on Twitch</h2>
  <div class="embed-row">
      <!-- Opt-in placeholder for Twitch stream: real iframe injected only after user consents -->
  <div class="twitch-placeholder" data-src="https://player.twitch.tv/?channel=ichatv&parent=localhost&parent=127.0.0.1&parent=icha-senpai.github.io" data-title="Twitch stream player" data-width="960" data-height="540">
        <div class="placeholder-inner">
          <strong>Twitch stream</strong>
          <p>The Twitch player is blocked until you choose to load it. Loading the player may cause Twitch to set third‑party cookies.</p>
          <div class="controls">
            <button class="btn btn-primary btn-sm load-embed">Load stream</button>
            <label class="remember-choice-label"><input type="checkbox" class="remember-choice"> Remember</label>
          </div>
        </div>
      </div>

      <!-- Opt-in placeholder for Twitch chat -->
  <div class="twitch-placeholder" data-type="chat" data-src="https://www.twitch.tv/embed/ichatv/chat?parent=localhost&parent=127.0.0.1&parent=icha-senpai.github.io" data-title="Twitch chat" data-width="350" data-height="540">
        <div class="placeholder-inner">
          <strong>Twitch chat</strong>
          <p>The chat is blocked until you choose to load it. Loading chat may cause Twitch to set third‑party cookies.</p>
          <div class="controls">
            <button class="btn btn-secondary btn-sm load-embed">Load chat</button>
            <label class="remember-choice-label"><input type="checkbox" class="remember-choice"> Remember</label>
          </div>
        </div>
      </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS (for navbar toggler) -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" crossorigin="anonymous" defer></script>
  <script>
    // Opt-in loader for third-party embeds to avoid setting third-party cookies until user consents.
    (function() {
      var STORAGE_KEY = 'twitch-embeds-consent-v1';
      function createIframe(src, title, w, h) {
        var ifr = document.createElement('iframe');
        ifr.src = src;
        ifr.title = title || '';
        ifr.width = w || '100%';
        ifr.height = h || '400';
        ifr.frameBorder = 0;
        ifr.scrolling = 'no';
        ifr.loading = 'lazy';
        ifr.referrerPolicy = 'no-referrer';
        ifr.allow = 'fullscreen';
        ifr.style.maxWidth = '100%';
        ifr.style.borderRadius = '8px';
        return ifr;
      }

      function injectPlaceholder(placeholder, remember) {
        var src = placeholder.getAttribute('data-src');
        var title = placeholder.getAttribute('data-title');
        var w = placeholder.getAttribute('data-width');
        var h = placeholder.getAttribute('data-height');
        var iframe = createIframe(src, title, w, h);
        // replace placeholder content
        placeholder.innerHTML = '';
        placeholder.appendChild(iframe);
        if (remember) {
          try { localStorage.setItem(STORAGE_KEY, 'true'); } catch (e) {}
        }
      }

      function init() {
        var consent = false;
        try { consent = !!localStorage.getItem(STORAGE_KEY); } catch (e) { consent = false; }
        var placeholders = document.querySelectorAll('.twitch-placeholder');
        placeholders.forEach(function(ph) {
          var btn = ph.querySelector('.load-embed');
          var chk = ph.querySelector('.remember-choice');
          if (consent) {
            injectPlaceholder(ph, false);
            return;
          }
          if (btn) btn.addEventListener('click', function() {
            var remember = chk && chk.checked;
            injectPlaceholder(ph, remember);
          });
        });
      }

      if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init); else init();
    })();
  </script>
</body>
</html>
