<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Preconnect and load Comic Neue Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Commodity Table - Icha's Place</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="css/custom.css" rel="stylesheet">
  <!-- Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="shortcut icon" href="images/favicon.ico">
  <meta name="theme-color" content="#ffffff">
  <link type="text/css" rel="stylesheet" href="resources/sheet.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@13.1.0/dist/handsontable.min.css">
  <!-- DOMPurify/Handsontable/HyperFormula scripts moved to the end of the body to avoid layout blocking -->
  <style>
    html, body {
      /* Avoid background-attachment: fixed (scroll-linked) which can cause jank on some browsers.
         Use the default scrolling background to improve async panning performance. */
  /* JPEG fallback */
  background-image: url('images/commodity-bg.jpg') !important;
  background-position: center center;
  background-size: cover;
  background-repeat: no-repeat;
      min-height: 100vh;
      height: auto !important;
      min-height: 100%;
      overflow-x: auto !important;
      overflow-y: auto !important;
      font-family: 'Comic Neue', 'Comic Sans MS', 'Comic Sans', cursive, sans-serif !important;
    }
    @supports (background-image: image-set(url('/images/optimized/commodity-bg-1600.avif') type('image/avif'))) {
      html, body {
        background-image: image-set(
          url('/images/optimized/commodity-bg-1600.avif') type('image/avif'),
          url('/images/optimized/commodity-bg-1600.webp') type('image/webp'),
          url('images/commodity-bg.jpg') type('image/jpeg')
        ) !important;
      }
    }
    /* ...existing code... */
    .handsontable, .handsontable td, .handsontable th, .ht_master, .htCore {
      background-color: #181818 !important;
      color: #fff !important;
      border-color: #333 !important;
    }
    .handsontable, .handsontable td, .handsontable th {
      font-family: 'Comic Neue', 'Comic Sans MS', 'Comic Sans', cursive, sans-serif !important;
    }
    * {
      font-family: 'Comic Neue', 'Comic Sans MS', 'Comic Sans', cursive, sans-serif !important;
    }

    /* Mobile-specific: reinforce dark zebra striping on small viewports to avoid white rows */
    @media (max-width: 767.98px) {
      .handsontable .ht_master tbody tr td { background-color: #181818 !important; }
      /* Stronger dark zebra to ensure visibility on iOS/Firefox */
      .handsontable .ht_master tbody tr:nth-child(even) td,
      .handsontable .htCore tr:nth-child(even) td,
      .handsontable .ht_clone_top tbody tr:nth-child(even) td { background-color: rgba(0,0,0,0.04) !important; }
      /* Neutralize any inline backgrounds Handsontable might add */
      .handsontable td[style] { background-image: none !important; background-color: inherit !important; }
    }

  </style>
</head>
<body class="fouc-hidden">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
        <ul class="navbar-nav d-flex justify-content-center w-100">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link active" href="commodity-table.html">Multi Contract Cargo Tracker</a></li>
          <li class="nav-item"><a class="nav-link" href="twitch.html">Twitch</a></li>
          <li class="nav-item"><a class="nav-link" href="https://github.com/icha-senpai/" target="_blank">GitHub</a></li>
          <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- Static toolbar for Handsontable controls (moved from JS) -->
  <div id="hot-toolbar">
    <div class="hot-toolbar-inner">
      <button id="toggle-ef" class="btn btn-warning btn-sm me-2" aria-pressed="false">Toggle Extra Stops</button>
      <button id="toggle-extra-rows" class="btn btn-info btn-sm me-2" aria-pressed="false">Toggle Extra Rows</button>
      <span id="hot-aria-live" class="visually-hidden" aria-live="polite" aria-atomic="true"></span>
    </div>
  </div>
  <div class="container py-5">
    <h2 class="mb-4" style="color: #fff;">Multi Contract Cargo Tracker</h2>
    <div class="hot-responsive-wrapper hot-hidden-until-ready">
      <div id="hot-container"></div>
    </div>
  </div>
  <style>
    /* Hide the Handsontable wrapper until JS initialization completes to avoid FOUC.
       Use opacity-based transition so the element keeps its layout while fading in. */
    .hot-responsive-wrapper {
      opacity: 1;
      transition: opacity 220ms ease-in-out;
    }
    .hot-responsive-wrapper.hot-hidden-until-ready {
      opacity: 0;
      visibility: hidden; /* keep hidden until JS removes the class */
      pointer-events: none; /* avoid accidental interactions while hidden */
    }
    /* Global FOUC prevention: hide the body until critical assets & JS are ready. */
    body.fouc-hidden {
      visibility: hidden !important;
      opacity: 0 !important;
      transition: opacity 220ms ease-in-out;
    }
    body { transition: opacity 220ms ease-in-out; }
  </style>
  <!-- Initialization script moved to external file (commodity-init.js) and will be loaded after libraries. -->
  <script src="commodity-table.js"></script>
  <!-- Load DOMPurify, Handsontable and HyperFormula after CSS/DOM to avoid blocking layout -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/handsontable@13.1.0/dist/handsontable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hyperformula@2.6.0/dist/hyperformula.full.min.js"></script>
  <!-- Page-specific initialization (runs after libraries are available). -->
  <script src="commodity-init.js"></script>
  <!-- Bootstrap JS (for navbar toggler) -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" crossorigin="anonymous" defer></script>
</body>
</html>
