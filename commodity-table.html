<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Preconnect and load Comic Neue Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Commodity Table - Icha's Place</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="css/custom.css" rel="stylesheet">
  <link type="text/css" rel="stylesheet" href="resources/sheet.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@13.1.0/dist/handsontable.min.css">
  <script src="https://cdn.jsdelivr.net/npm/handsontable@13.1.0/dist/handsontable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hyperformula@2.6.0/dist/hyperformula.full.min.js"></script>
  <style>
    html, body {
      background: url('https://dto9r5vaiz7bu.cloudfront.net/hmqh11zt822qr/source.jpg') center center/cover no-repeat fixed !important;
      min-height: 100vh;
      height: auto !important;
      min-height: 100%;
      overflow-x: auto !important;
      overflow-y: auto !important;
      font-family: 'Comic Neue', 'Comic Sans MS', 'Comic Sans', cursive, sans-serif !important;
    }
    /* ...existing code... */
    .handsontable, .handsontable td, .handsontable th, .ht_master, .htCore {
      background-color: #181818 !important;
      color: #fff !important;
      border-color: #333 !important;
    }
    .handsontable, .handsontable td, .handsontable th {
      font-family: 'Comic Neue', 'Comic Sans MS', 'Comic Sans', cursive, sans-serif !important;
    }
    * {
      font-family: 'Comic Neue', 'Comic Sans MS', 'Comic Sans', cursive, sans-serif !important;
    }

    /* Responsive Handsontable wrapper for mobile */
    .hot-responsive-wrapper {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      background: rgba(24,24,24,0.1);
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.12);
      padding: 0.5rem 0.25rem;
    }

    /* Sticky headers for table */
    .handsontable th {
      position: sticky !important;
      top: 0;
      z-index: 10;
      background: #222 !important;
    }

    @media (max-width: 900px) {
      #hot-container {
        min-width: 600px;
        font-size: 1.08em;
      }
      .handsontable td, .handsontable th {
        font-size: 1.15em !important;
        padding: 1em 0.6em !important;
        min-width: 70px !important;
        min-height: 44px !important;
      }
      .btn, .btn-back-transparent {
        font-size: 1.15em;
        padding: 0.9em 1.5em;
      }
    }
    @media (max-width: 600px) {
      #hot-container {
        min-width: 420px;
        font-size: 1em;
      }
      .handsontable td, .handsontable th {
        font-size: 1.08em !important;
        padding: 0.8em 0.3em !important;
        min-width: 54px !important;
        min-height: 38px !important;
      }
      .btn, .btn-back-transparent {
        font-size: 1.08em;
        padding: 0.7em 1.1em;
      }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
        <ul class="navbar-nav d-flex justify-content-center w-100">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link active" href="commodity-table.html">Multi Contract Cargo Tracker</a></li>
          <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
          <li class="nav-item"><a class="nav-link" href="http://www.twitch.tv/ichatv" target="_blank">Twitch</a></li>
          <li class="nav-item"><a class="nav-link" href="https://www.youtube.com/user/ichabob3901" target="_blank">YouTube</a></li>
          <li class="nav-item"><a class="nav-link" href="https://x.com/Its__Icha" target="_blank">X</a></li>
          <li class="nav-item"><a class="nav-link" href="https://www.facebook.com/Volniks/" target="_blank">Facebook</a></li>
          <li class="nav-item"><a class="nav-link" href="https://github.com/icha-senpai/" target="_blank">GitHub</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container py-5">
    <h2 class="mb-4" style="color: #fff;">Multi Contract Cargo Tracker</h2>
    <div class="hot-responsive-wrapper">
      <div id="hot-container"></div>
    </div>
    <a href="index.html" class="btn btn-back-transparent mt-4">Back to Home</a>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Define the header row
      const hotHeader = ['Commodity', 'Dropoff 1', 'Dropoff 2', 'Dropoff 3', 'Dropoff 4', 'Dropoff 5', 'SCU Total', 'Contract Payout', 'Contract Payout (num)'];
      // Define the commodity names for the first 13 rows
      const commodityNames = [
        'Aluminum', 'Carbon', 'Corundum', 'Ice', 'Quartz', 'Proc Food', 'Silicon', 'Stims', 'Titanium', 'Tin', 'Tungsten', 'Waste', ''
      ];
      // Generate rows 2-14 (1-based, 0-based index 1-13) with commodity names and formulas
      const hotRows = commodityNames.map((name, i) => {
        const rowNum = i + 2; // Excel-style row number
        return [name, '', '', '', '', '', `=SUM(B${rowNum}:F${rowNum})`, '', ''];
      });
      // Generate rows 15-123 (0-based index 14-122) as blank with formula in G
      const extraRows = Array.from({length: 109}, (_, i) => {
        const rowNum = 15 + i;
        return ['', '', '', '', '', '', `=SUM(B${rowNum}:F${rowNum})`, '', ''];
      });
      // Totals row (row 124, 0-based index 123)
      const totalsRow = [
        'Totals',
        '=SUM(B2:B123)',
        '=SUM(C2:C123)',
        '=SUM(D2:D123)',
        '=SUM(E2:E123)',
        '=SUM(F2:F123)',
        '=SUM(G2:G123)',
        '=SUM(H2:H123)',
        '=SUM(I2:I123)',
        '=SUM(I2:I123)'
      ];
      // Combine all rows
      const hotData = [hotHeader, ...hotRows, ...extraRows, totalsRow];
      const container = document.getElementById('hot-container');
      const hot = new Handsontable(container, {
        data: hotData,
        rowHeaders: true,
        colHeaders: true,
        licenseKey: 'non-commercial-and-evaluation',
        width: '100%',
        height: 600,
        stretchH: 'all',
        hiddenColumns: {
          columns: [4,5,8],
          indicators: false
        },
        hiddenRows: {
          rows: Array.from({length: 109}, (_, i) => i + 14),
          indicators: false
        },
        manualColumnResize: true,
        manualRowResize: true,
        filters: true,
        dropdownMenu: true,
        contextMenu: true,
        readOnly: false,
        comments: true,
        cells: function(row, col) {
          const cellProperties = {};
          // Commodity dropdown for all rows 1-122 (2-123 Excel), col 0
          const isDataRow = row > 0 && row < 123;
          if (col === 0 && isDataRow) {
            cellProperties.editor = 'select';
            cellProperties.selectOptions = [
              'AcryliPlex Composite', 'Audio Visual Equipment', 'Bioplastic', 'Carbon-Silk', 'Construction Materials',
              'Diamond Laminate', 'DynaFlex', 'Kopion Horn', 'Luminalia Gift Box', 'Marok Gem', 'Neograph', 'Omnapoxy',
              'Party Favors', 'Red Festival Envelope', 'Ship Ammunition', 'Souvenirs', 'Thermalfoam', 'Year of the Dog Envelope',
              'Year of the Monkey Envelope', 'Year of the Pig', 'Year of the Ram Envelope', 'Year of the Rooster Envelope',
              'Agricium', 'Agricium Ore', 'Aluminum', 'Aluminum Ore', 'Borase', 'Borase Ore', 'Carbon', 'Cobalt', 'Copper',
              'Copper Ore', 'Gold', 'Gold Ore', 'Iron', 'Iron Ore', 'Mercury', 'Riccite', 'Silicon', 'Stileron', 'Tin',
              'Titanium', 'Titanium Ore', 'Tungsten', 'Tungsten Ore', "Xa' Pyen", 'Agricultural Supplies', 'DCSR2',
              'Ranta Dung', 'Altruciatoxin', 'Distilled Spirits', "E'tam", 'Gasping Weevil Eggs', 'Maze', 'Neon',
              'Osoian Hides', 'Revenant Tree Pollen', 'SLAM', 'Stims', 'WiDow', 'Amioshi Plague', 'Degnous Root',
              'Golden Medmons', 'Heart of the Woods', 'Jumping Limes', 'Pitambu', 'Prota', 'Revenant Pods', 'Sunset Berries',
              'Ammonia', 'Argon', 'Astatine', 'Chlorine', 'Fluorine', 'Helium', 'Hydrogen', 'Iodine', 'Methane', 'Nitrogen',
              'Partillium', 'Pressurized Ice', 'Aphorite', 'Beryl', 'Beryl Raw', 'Bexalite', 'Bexalite Raw', 'Corundum',
              'Corundum Raw', 'Diamond', 'Diamond Raw', 'Dolivine', 'Hadanite', 'Hephaestanite', 'Hephaestanite Raw',
              'Janalite', 'Laranite', 'Laranite Raw', 'Potassium', 'Quantainium', 'Quantainium Raw', 'Quartz', 'Quartz Raw',
              'Taranite', 'Taranite Raw', 'Atlasium', 'Beradom', 'Dymantium', 'Feynmaline', 'Glacosite', 'Steel', 'Compboard',
              'Scrap', 'Fresh Food', 'Human Food Bars', 'Processed Food', 'Inert Materials', 'Medical Supplies',
              'Recycled Material Composite', 'Waste', 'Other', 'Custom'
            ];
          }
          // Make the totals row (row 123) bold and read-only
          if (row === 123) {
            cellProperties.className = 'htBold';
            cellProperties.readOnly = true;
          }
          // Make A1, G1, and H1 read-only (row 0, col 0, 6, 7)
          if (row === 0 && (col === 0 || col === 6 || col === 7)) {
            cellProperties.readOnly = true;
          }
          // Format currency columns (H) for data rows
          if (col === 7 && isDataRow) {
            cellProperties.type = 'text';
            cellProperties.renderer = function(instance, td, row, col, prop, value, cellProperties) {
              Handsontable.renderers.TextRenderer.apply(this, arguments);
              td.style.color = '#007bff';
              td.style.fontWeight = 'bold';
              if (!isNaN(value) && value !== null && value !== '') {
                td.textContent = '$' + Number(value).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
              }
            };
          }
          // Hide helper column I from styling
          if (col === 8) {
            cellProperties.readOnly = true;
          }
          return cellProperties;
        },
        dropdownMenu: [
          'filter_by_condition', 'filter_by_value', 'filter_action_bar',
          'freeze_column', 'freeze_row', 'remove_row', 'remove_col',
          'row_above', 'row_below', 'col_left', 'col_right',
          'clear_column', 'clear_custom_sort', 'undo', 'redo',
          'make_read_only', 'alignment', 'commentsAddEdit', 'commentsRemove',
          'mergeCells', 'unmergeCells', 'copy', 'cut', 'paste'
        ],
        contextMenu: [
          'row_above', 'row_below', 'col_left', 'col_right',
          'remove_row', 'remove_col', 'undo', 'redo',
          'make_read_only', 'alignment', 'commentsAddEdit', 'commentsRemove',
          'mergeCells', 'unmergeCells', 'copy', 'cut', 'paste'
        ],
        formulas: {
          engine: HyperFormula
        },
        allowInsertRow: true,
        allowInsertColumn: true,
        allowRemoveRow: true,
        allowRemoveColumn: true,
        manualColumnFreeze: true,
        manualRowMove: true,
        manualColumnMove: true,
        autoColumnSize: true,
        autoRowSize: true,
        multiColumnSorting: true,
        multiRowSorting: true
  });
  // Expose Handsontable instance for external scripts (after initialization)
  container.handsontableInstance = hot;
    });
  </script>
  <script src="commodity-table.js"></script>
  <!-- Bootstrap JS (for navbar toggler) -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" crossorigin="anonymous" defer></script>
</body>
</html>
